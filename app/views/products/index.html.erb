<% title "Productos" %>

<div id="categories">
	<h2>Filter products</h2>
	<% form_tag products_path, :method => :get  do %>
		<p>
			<%= label_tag :keyword, "Name or Product Key" %><br/>
			<%= text_field_tag :keyword, params[:keyword] %>
		</p>
		<p>
			<%= label_tag :category %><br/>
			<%= select_tag :category, all_categories_option + options_from_collection_for_select(Category.all, 'id', 'name', params[:category].to_i) %>
			<br />
		</p>
		<%= submit_tag "Filter" %>
	<% end %>
	<h2>Modify Discount</h2>
	<% form_tag products_path, :method => 'post' do %>
		<%= label_tag :discount, "New Discount" %> <br />
		<%= hidden_field_tag :create_type, "discount" %>
		<%= text_field_tag :discount %>%
		<%= submit_tag "Modify", :id => 'new_discount_for_all' %>
	<% end %>
	<%= image_tag "indicator.gif", :style => 'display:none;', :id => 'indicator' %>
</div>

<div id="content">
	<h1>Products</h1>
	<p>
		Listando <b><%= @products.size %> de <%= @products.total_entries %></b> Productos
	</p>
	<table>
	  <tr>
	    <th>ID</th>
	    <th>Key</th>
		<th>Name</th>
	    <th>Category</th>
	    <th>Price</th>
	    <th>Edit</th>
	    <th>Delete</th>
	  </tr>
	  <% for product in @products %>
	    <tr>
	      <td><%=h product.id %></td>
	      <td><%=h product.product_key %></td>
	      <td><%= link_to truncate(product.name, 30), product %></td>
	      <td><%=h product.tag.subcategory.category.name %></td>
	      <td><%= number_to_currency product.selling_price %></td>
	      <td><%= link_to "Edit", edit_product_path(product) %></td>
	      <td><%= link_to "Delete", product, :confirm => 'Estas seguro?', :method => :delete %></td>
	    </tr>
	  <% end %>
	</table>
	<p>
		<%= will_paginate @products %>
	</p>
	<div style="clear:both"></div>

	<p><%= link_to "New product", new_product_path %></p>
	<p><%= link_to "Bulk create products", new_product_path(:new_type => 'mass') %></p>
</div>
